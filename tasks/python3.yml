---

- name: Register version check
  shell: python3 --version | grep {{ python3_version  }}
  register: current_version
  ignore_errors: true
  changed_when: current_version.rc != 0

- name: Install python3 build dependencies
  become: true
  yum:
    name:
      - bzip2-devel
      - libffi-devel
      - openssl-devel
      - sqlite-devel
      - xd-devel
      - uuid-devel
  when: current_version.rc != 0

- name: Install python versions
  become: true
  shell: |
    cd /usr/src
    wget https://www.python.org/ftp/python/{{ item }}\
    /Python-{{ item }}.tgz
    tar xzf Python-{{ item }}.tgz
    cd Python-{{ item }}
    ./configure --enable-optimizations
    make altinstall --exec-prefix=/usr/local
    cd ..
    rm Python-{{ item }}.tgz
    # ln -fs /usr/local/bin/python{{ item[:3]  }} \
    # /usr/local/bin/python3
    # ln -fs /usr/local/bin/pip{{ item[:3]  }} /usr/local/bin/pip3
  with_items: "{{ python_versions }}"
  when: current_version.rc != 0

- name: Install pip packages
  pip:
    name:
      - speedtest-cli
    executable: pip3
